{"version":3,"file":"ccat-block-frontend.js","mappings":"2CASiBA,EAAE,EAAQ,KAASC,EAAEC,OAAOC,IAAI,iBAAgDC,GAA7BF,OAAOC,IAAI,kBAAoBE,OAAOC,UAAUC,gBAAeC,EAAER,EAAES,mDAAmDC,kBAAkBC,EAAE,CAACC,KAAI,EAAGC,KAAI,EAAGC,QAAO,EAAGC,UAAS,GAChP,SAASC,EAAEC,EAAEC,EAAEC,GAAG,IAAIC,EAAEC,EAAE,CAAC,EAAEC,EAAE,KAAKC,EAAE,KAAiF,IAAIH,UAAhF,IAASD,IAAIG,EAAE,GAAGH,QAAG,IAASD,EAAEN,MAAMU,EAAE,GAAGJ,EAAEN,UAAK,IAASM,EAAEL,MAAMU,EAAEL,EAAEL,KAAcK,EAAEd,EAAEoB,KAAKN,EAAEE,KAAKT,EAAEJ,eAAea,KAAKC,EAAED,GAAGF,EAAEE,IAAI,GAAGH,GAAGA,EAAEQ,aAAa,IAAIL,KAAKF,EAAED,EAAEQ,kBAAe,IAASJ,EAAED,KAAKC,EAAED,GAAGF,EAAEE,IAAI,MAAM,CAACM,SAASzB,EAAE0B,KAAKV,EAAEL,IAAIU,EAAET,IAAIU,EAAEK,MAAMP,EAAEQ,OAAOrB,EAAEsB,QAAQ,CAAoBC,EAAQC,IAAIhB,EAAEe,EAAQE,KAAKjB,C,UCV1WkB,EAAOH,QAAUI,OAAc,K,gBCG7BD,EAAOH,QAAU,EAAjB,G,GCFEK,EAA2B,CAAC,ECDhC,MAAM,EAA+BD,OAAW,GAAkB,eCA5D,EAA+BA,OAAW,GAAW,QCAtBA,OAAW,GAAQ,K,MHIxD,SAASE,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqBE,IAAjBD,EACH,OAAOA,EAAaR,QAGrB,IAAIG,EAASE,EAAyBE,GAAY,CAGjDP,QAAS,CAAC,GAOX,OAHAU,EAAoBH,GAAUJ,EAAQA,EAAOH,QAASM,GAG/CH,EAAOH,OACf,C,MI8HAI,OAAOO,qBAAwBC,IACvBR,OAAOS,QACPT,OAAOS,OAAOC,YAAY,CAACF,aAAY,IAC3C,E,+aClJJG,EAAAA,EAAAA,uBAAsB,CAClBC,SAAQ,EACRC,UDHiBC,EAAEC,4BACnBC,QAAQC,IAAI,cAAeF,GAG3B,MAAMG,EAAWlB,OAAOmB,IAAIC,YAAYC,WAAW,uBAAwB,CACvEC,gBAAiB,CAAC,EAClBC,OAAQ,CACJC,YAAa,aACbC,cAAe,QACfC,YAAa,SACbC,aAAc,QAKjBT,EAASI,iBAAoE,IAAjDpD,OAAO0D,KAAKV,EAASI,iBAAiBO,SACnEX,EAASI,gBAAkB,CACvB,sBAAyB,CACrBQ,IAAK,yCAET,0BAA6B,CACzBA,IAAK,2CAMjB,MAAOL,EAAeM,IAAoBC,EAAAA,EAAAA,WAAS,KAE/C,IACI,MAAMC,EAAaC,aAAaC,QAAQ,uBACxC,OAAOF,EAAaG,KAAKC,MAAMJ,GAAc,IACjD,CAAE,MAAO9C,GAEL,OADA6B,QAAQsB,MAAM,gBAAiBnD,GACxB,IACX,KAuEJ,OACIoD,EAAAA,EAAAA,KAAA,OAAKC,UAAU,4BAA2BC,UACtCF,EAAAA,EAAAA,KAAA,OAAKC,UAAU,qCAAoCC,UAC/CC,EAAAA,EAAAA,MAAA,OAAKF,UAAU,iCAAgCC,SAAA,EAC3CF,EAAAA,EAAAA,KAAA,MAAIC,UAAU,4BAA2BC,SAAC,eAE1CF,EAAAA,EAAAA,KAAA,UACIC,UAAU,+CACVG,QAlDMC,KAEtB,MAAMC,EAAe3E,OAAO4E,OAAO5B,EAASI,iBAAiB,GAC7D,IAAKuB,IAAiBA,EAAaf,IAE/B,YADAd,QAAQsB,MAAM,cAKlB,MAAMS,EAAQ/C,OAAOgD,KACjBH,EAAaf,IACb,iBACA,wBAIEmB,EAAiBC,IACnB,IACQA,EAAMC,MAAQD,EAAMC,KAAK3C,YAxCXA,KAE1BuB,EAAiBvB,GAGjB,IACI0B,aAAakB,QAAQ,sBAAuBhB,KAAKiB,UAAU7C,GAC/D,CAAE,MAAOrB,GACL6B,QAAQsB,MAAM,0BAA2BnD,EAC7C,CAGI4B,GAAyBA,EAAsBuC,kBAC/CvC,EAAsBuC,iBAAiB,uBAAwB,CAC3DC,UAAW/C,EAAU+C,UACrBC,UAAWhD,EAAUgD,UACrB7B,aAAcnB,EAAUmB,cAEhC,EAuBYpB,CAAqB2C,EAAMC,KAAK3C,WAG5BuC,GACAA,EAAMU,QAIVzD,OAAO0D,oBAAoB,UAAWT,GAE9C,CAAE,MAAOX,GACLtB,QAAQsB,MAAM,eAAgBA,EAClC,GAGJtC,OAAO2D,iBAAiB,UAAWV,EAAc,EAiBjCW,MAAO,CAACC,MAAO,OAAQC,aAAc,QAAQrB,SAE5ChB,EAAgBP,EAASK,OAAOG,YAAcR,EAASK,OAAOC,cAGlEC,IACGiB,EAAAA,EAAAA,MAAA,OAAKF,UAAU,2BAA2BoB,MAAO,CAC7CG,QAAS,OACTC,gBAAiB,UACjBC,OAAQ,iBACRC,aAAc,OAChBzB,SAAA,EACEC,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACIC,EAAAA,EAAAA,MAAA,UAAAD,SAAA,CAASvB,EAASK,OAAOE,cAAc,OACtCA,EAAc+B,UAAU,KAAG/B,EAAc8B,UAAU,QAExDb,EAAAA,EAAAA,MAAA,OAAAD,SAAA,EACIC,EAAAA,EAAAA,MAAA,UAAAD,SAAA,CAASvB,EAASK,OAAOI,aAAa,OACrCF,EAAcE,yBAMjC,G","sources":["webpack://ccat-checkout-block/./node_modules/react/cjs/react-jsx-runtime.production.min.js","webpack://ccat-checkout-block/external window \"React\"","webpack://ccat-checkout-block/./node_modules/react/jsx-runtime.js","webpack://ccat-checkout-block/webpack/bootstrap","webpack://ccat-checkout-block/external window [\"wc\",\"blocksCheckout\"]","webpack://ccat-checkout-block/external window [\"wp\",\"element\"]","webpack://ccat-checkout-block/external window [\"wp\",\"i18n\"]","webpack://ccat-checkout-block/./src/js/ccat-block/block.js","webpack://ccat-checkout-block/./src/js/ccat-block/frontend.js"],"sourcesContent":["/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n'use strict';var f=require(\"react\"),k=Symbol.for(\"react.element\"),l=Symbol.for(\"react.fragment\"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};\nfunction q(c,a,g){var b,d={},e=null,h=null;void 0!==g&&(e=\"\"+g);void 0!==a.key&&(e=\"\"+a.key);void 0!==a.ref&&(h=a.ref);for(b in a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps,a)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.Fragment=l;exports.jsx=q;exports.jsxs=q;\n","module.exports = window[\"React\"];","'use strict';\n\nif (process.env.NODE_ENV === 'production') {\n  module.exports = require('./cjs/react-jsx-runtime.production.min.js');\n} else {\n  module.exports = require('./cjs/react-jsx-runtime.development.js');\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wc\"][\"blocksCheckout\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"element\"];","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"i18n\"];","import {useState, useEffect} from '@wordpress/element';\r\nimport {__} from '@wordpress/i18n';\r\n\r\n// 超商選擇器區塊\r\nexport const Block = ({checkoutExtensionData}) => {\r\n    console.log('超商選擇器區塊組件渲染', checkoutExtensionData);\r\n\r\n    // 獲取配置\r\n    const settings = window.wc?.wcSettings?.getSetting('ccat--store-selector', {\r\n        shippingMethods: {},\r\n        labels: {\r\n            selectStore: '選擇7-11超商門市',\r\n            selectedStore: '已選擇門市',\r\n            changeStore: '變更超商門市',\r\n            storeAddress: '地址'\r\n        }\r\n    });\r\n\r\n    // 如果設定中沒有運送方法，使用測試資料\r\n    if (!settings.shippingMethods || Object.keys(settings.shippingMethods).length === 0) {\r\n        settings.shippingMethods = {\r\n            'wc_shipping_ccat__cod': {\r\n                url: 'https://emap.pcsc.com.tw/EMapSDK.aspx'\r\n            },\r\n            'wc_shipping_ccat__prepaid': {\r\n                url: 'https://emap.pcsc.com.tw/EMapSDK.aspx'\r\n            }\r\n        };\r\n    }\r\n\r\n    // 獲取已選擇的店鋪資訊\r\n    const [selectedStore, setSelectedStore] = useState(() => {\r\n        // 嘗試從localStorage讀取已存的資料\r\n        try {\r\n            const savedStore = localStorage.getItem('ccat_selected_store');\r\n            return savedStore ? JSON.parse(savedStore) : null;\r\n        } catch (e) {\r\n            console.error('讀取儲存的超商資訊時出錯:', e);\r\n            return null;\r\n        }\r\n    });\r\n\r\n    // 檢查是否為7-11運送方式\r\n    const isShipping = true; // 為了測試，先設為true，實際環境需根據選擇的運送方式判斷\r\n\r\n    // 處理超商選擇\r\n    const handleStoreSelection = (storeInfo) => {\r\n        // 保存選擇的超商資訊\r\n        setSelectedStore(storeInfo);\r\n\r\n        // 儲存到localStorage\r\n        try {\r\n            localStorage.setItem('ccat_selected_store', JSON.stringify(storeInfo));\r\n        } catch (e) {\r\n            console.error('儲存超商資訊到localStorage時出錯:', e);\r\n        }\r\n\r\n        // 提交到結帳數據\r\n        if (checkoutExtensionData && checkoutExtensionData.setExtensionData) {\r\n            checkoutExtensionData.setExtensionData('ccat--store-selector', {\r\n                storeCode: storeInfo.storeCode,\r\n                storeName: storeInfo.storeName,\r\n                storeAddress: storeInfo.storeAddress\r\n            });\r\n        }\r\n    };\r\n\r\n    // 打開超商選擇視窗\r\n    const openStoreSelector = () => {\r\n        // 使用第一個可用的運送方法\r\n        const methodConfig = Object.values(settings.shippingMethods)[0];\r\n        if (!methodConfig || !methodConfig.url) {\r\n            console.error('找不到運送方式的配置');\r\n            return;\r\n        }\r\n\r\n        // 打開新視窗進行超商選擇\r\n        const popup = window.open(\r\n            methodConfig.url,\r\n            'storeSelection',\r\n            'width=800,height=600'\r\n        );\r\n\r\n        // 設置視窗訊息監聽\r\n        const handleMessage = (event) => {\r\n            try {\r\n                if (event.data && event.data.storeInfo) {\r\n                    handleStoreSelection(event.data.storeInfo);\r\n\r\n                    // 關閉選擇視窗\r\n                    if (popup) {\r\n                        popup.close();\r\n                    }\r\n\r\n                    // 移除監聽器\r\n                    window.removeEventListener('message', handleMessage);\r\n                }\r\n            } catch (error) {\r\n                console.error('處理超商選擇訊息時出錯:', error);\r\n            }\r\n        };\r\n\r\n        window.addEventListener('message', handleMessage);\r\n    };\r\n\r\n    // 如果不是7-11運送方式，則不顯示\r\n    if (!isShipping) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className=\"wc-block-components-panel\">\r\n            <div className=\"wc-block-components-panel__content\">\r\n                <div className=\"ccat--store-selector-container\">\r\n                    <h3 className=\"wc-block-components-title\">7-11 超商取貨</h3>\r\n\r\n                    <button\r\n                        className=\"wc-block-components-button wp-element-button\"\r\n                        onClick={openStoreSelector}\r\n                        style={{width: '100%', marginBottom: '10px'}}\r\n                    >\r\n                        {selectedStore ? settings.labels.changeStore : settings.labels.selectStore}\r\n                    </button>\r\n\r\n                    {selectedStore && (\r\n                        <div className=\"ccat-selected-store-info\" style={{\r\n                            padding: '10px',\r\n                            backgroundColor: '#f8f8f8',\r\n                            border: '1px solid #ddd',\r\n                            borderRadius: '4px'\r\n                        }}>\r\n                            <div>\r\n                                <strong>{settings.labels.selectedStore}:</strong>\r\n                                {selectedStore.storeName} ({selectedStore.storeCode})\r\n                            </div>\r\n                            <div>\r\n                                <strong>{settings.labels.storeAddress}:</strong>\r\n                                {selectedStore.storeAddress}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// 添加視窗郵件處理函數\r\nwindow.handleStoreSelection = (storeInfo) => {\r\n    if (window.opener) {\r\n        window.opener.postMessage({storeInfo}, '*');\r\n    }\r\n};","import {registerCheckoutBlock} from '@woocommerce/blocks-checkout'\r\n\r\nimport {Block} from './block'\r\nimport metadata from './block.json'\r\n\r\nregisterCheckoutBlock({\r\n    metadata,\r\n    component: Block,\r\n});"],"names":["f","k","Symbol","for","m","Object","prototype","hasOwnProperty","n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","p","key","ref","__self","__source","q","c","a","g","b","d","e","h","call","defaultProps","$$typeof","type","props","_owner","current","exports","jsx","jsxs","module","window","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","handleStoreSelection","storeInfo","opener","postMessage","registerCheckoutBlock","metadata","component","Block","checkoutExtensionData","console","log","settings","wc","wcSettings","getSetting","shippingMethods","labels","selectStore","selectedStore","changeStore","storeAddress","keys","length","url","setSelectedStore","useState","savedStore","localStorage","getItem","JSON","parse","error","_jsx","className","children","_jsxs","onClick","openStoreSelector","methodConfig","values","popup","open","handleMessage","event","data","setItem","stringify","setExtensionData","storeCode","storeName","close","removeEventListener","addEventListener","style","width","marginBottom","padding","backgroundColor","border","borderRadius"],"sourceRoot":""}